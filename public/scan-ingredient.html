<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Scan Ingredient</title>
    <link
      href="https://fonts.googleapis.com/css?family=Playfair+Display:700|Montserrat:400,500,700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --pink-1: #d8e2dc;
        --pink-2: #ffe5d9;
        --pink-3: #ffcad4;
        --pink-4: #f4acb7;
        --pink-5: #9d8189;
        --accent: #f672a7;
      }
      html,
      body {
        min-height: 100%;
        margin: 0;
        font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial;
      }
      body {
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(
          135deg,
          var(--pink-1) 0%,
          var(--pink-2) 25%,
          var(--pink-3) 50%,
          var(--pink-4) 75%,
          var(--pink-5) 100%
        );
        /* was overflow:hidden; */
        overflow-y: auto;
        position: relative;
        padding: 24px; /* helps on small screens */
      }
      .makeup-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        opacity: 0.12;
        z-index: 0;
        background: url("https://raw.githubusercontent.com/angelazhao06/formulyst-assets/main/makeup-bg.svg")
          center/cover no-repeat;
      }
      .back-btn {
        position: fixed;
        top: 28px;
        left: 28px;
        z-index: 30;
        background: #fff;
        color: var(--accent);
        border: 0;
        border-radius: 999px;
        padding: 10px 18px;
        font-weight: 600;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        cursor: pointer;
      }
      .back-btn svg {
        vertical-align: middle;
        margin-right: 8px;
        width: 16px;
        height: 16px;
      }
      .panel {
        background: #fff;
        border-radius: 20px;
        padding: 44px 36px;
        box-shadow: 0 10px 40px rgba(157, 129, 137, 0.12);
        max-width: 420px;
        width: 88%;
        text-align: center;
        z-index: 20;
      }
      h1 {
        font-family: "Playfair Display", serif;
        color: #22223b;
        margin: 0 0 20px;
        font-size: 2.1rem;
      }
      .actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-bottom: 18px;
      }
      .actions button {
        background: var(--accent);
        color: #fff;
        border: 0;
        padding: 10px 18px;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: box-shadow 0.2s;
      }
      .actions button:hover {
        box-shadow: 0 4px 16px rgba(157, 129, 137, 0.18);
      }
      label {
        display: block;
        color: #4a4e69;
        margin-bottom: 8px;
        font-weight: 500;
      }
      input[type="text"] {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #eee;
      }
      .search-btn {
        transition: box-shadow 0.2s;
      }
      .search-btn:hover {
        box-shadow: 0 8px 32px rgba(246, 114, 167, 0.35) !important;
      }
      /* decorative icons */
      .icon-left,
      .icon-right {
        position: fixed;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0.14;
        z-index: 10;
      }
      .icon-left {
        left: 6vw;
        width: 120px;
      }
      .icon-right {
        right: 12vw;
        width: 120px;
        opacity: 0.28;
      }
      /* hearts */
      .heart {
        position: fixed;
        opacity: 0.34;
        z-index: 5;
      }
      .heart.h1 {
        left: 14%;
        top: 12%;
        width: 36px;
      }
      .heart.h2 {
        left: 10%;
        bottom: 12%;
        width: 28px;
      }
      .heart.h3 {
        right: 10%;
        top: 18%;
        width: 32px;
      }
      @media (max-width: 720px) {
        .icon-left,
        .icon-right,
        .heart {
          display: none;
        }
        .panel {
          width: 94%;
        }
      }
    </style>
  </head>
  <body>
    <div class="makeup-bg"></div>
    <!-- back: explicit home link -->
    <button
      class="back-btn"
      onclick="window.location.href='/public/index.html'"
      aria-label="Back to home"
    >
      <span
        style="
          font-size: 2rem;
          font-weight: 700;
          vertical-align: middle;
          margin-right: 12px;
        "
        >&lt;</span
      >
      <span style="font-size: 1.35rem; font-weight: 700; vertical-align: middle"
        >Back</span
      >
    </button>

    <!-- decorative icons -->
    <div class="icon-left" aria-hidden="true">
      <svg viewBox="0 0 64 64" width="120" height="120">
        <ellipse cx="32" cy="48" rx="20" ry="12" fill="#fff0f6" />
        <rect
          x="18"
          y="24"
          width="28"
          height="24"
          rx="10"
          fill="#fcb7d4"
          stroke="#f672a7"
          stroke-width="2"
        />
        <ellipse cx="32" cy="24" rx="14" ry="6" fill="#fff0f6" />
      </svg>
    </div>
    <div class="icon-right" aria-hidden="true">
      <svg viewBox="0 0 64 64" width="120" height="120">
        <ellipse cx="32" cy="54" rx="16" ry="8" fill="#fff0f6" />
        <rect
          x="24"
          y="22"
          width="16"
          height="32"
          rx="8"
          fill="#7ad7f0"
          stroke="#1e90c2"
          stroke-width="2"
        />
        <rect
          x="28"
          y="10"
          width="8"
          height="16"
          rx="4"
          fill="#fff"
          stroke="#1e90c2"
          stroke-width="2"
        />
        <rect x="30" y="6" width="4" height="8" rx="2" fill="#1e90c2" />
      </svg>
    </div>

    <!-- hearts -->
    <svg class="heart h1" viewBox="0 0 32 29">
      <path
        d="M23.6,0c-2.7,0-5,1.7-6.6,4.3C15,1.7,12.7,0,10,0C4.5,0,0,4.5,0,10c0,9.2,16,19,16,19s16-9.8,16-19C32,4.5,27.5,0,23.6,0z"
        fill="#f672a7"
      />
    </svg>
    <svg class="heart h2" viewBox="0 0 32 29">
      <path
        d="M23.6,0c-2.7,0-5,1.7-6.6,4.3C15,1.7,12.7,0,10,0C4.5,0,0,4.5,0,10c0,9.2,16,19,16,19s16-9.8,16-19C32,4.5,27.5,0,23.6,0z"
        fill="#fcb7d4"
      />
    </svg>
    <svg class="heart h3" viewBox="0 0 32 29">
      <path
        d="M23.6,0c-2.7,0-5,1.7-6.6,4.3C15,1.7,12.7,0,10,0C4.5,0,0,4.5,0,10c0,9.2,16,19,16,19s16-9.8,16-19C32,4.5,27.5,0,23.6,0z"
        fill="#f7a1c4"
      />
    </svg>

    <main class="panel" role="main">
      <div style="margin-bottom: 18px">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="#4A3B36"
          style="
            width: 64px;
            height: 64px;
            display: block;
            margin: 0 auto 12px auto;
          "
        >
          <circle
            cx="12"
            cy="13"
            r="3.2"
            stroke="#4A3B36"
            stroke-width="2"
            fill="none"
          />
          <rect
            x="4"
            y="7"
            width="16"
            height="12"
            rx="4"
            stroke="#4A3B36"
            stroke-width="2"
            fill="none"
          />
          <rect
            x="9"
            y="3"
            width="6"
            height="4"
            rx="2"
            stroke="#4A3B36"
            stroke-width="2"
            fill="none"
          />
        </svg>
        <h2
          style="
            font-family: Montserrat, sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: #4a3b36;
            margin: 0;
          "
        >
          Take a Picture / Upload
        </h2>
      </div>

      <form id="scan-ingredient-form">
        <div class="actions">
          <button type="button" id="upload-picture">Upload Picture</button>
          <button type="button" id="take-picture">Take Picture</button>
        </div>

        <div style="text-align: left; margin-bottom: 18px">
          <input
            id="brand-name"
            name="brand-name"
            type="text"
            placeholder="Type product name (e.g. Fenty Gloss Bomb)"
            style="
              width: 100%;
              padding: 14px 12px;
              border-radius: 14px;
              border: 2px solid #eee;
              font-size: 1.1rem;
              color: #4a4e69;
              background: #fff;
              margin-top: 8px;
            "
          />
        </div>

        <button
          type="submit"
          class="search-btn"
          style="
            width: 100%;
            background: linear-gradient(90deg, #f672a7, #fcb7d4);
            color: #fff;
            font-weight: 700;
            font-size: 1.25rem;
            padding: 16px 0;
            border: none;
            border-radius: 999px;
            box-shadow: 0 4px 16px rgba(246, 114, 167, 0.18);
            margin-bottom: 12px;
            cursor: pointer;
            letter-spacing: 0.5px;
          "
        >
          Search Product
        </button>

        <!-- preview -->
        <div
          id="preview"
          style="margin-top: 16px; text-align: center; display: none"
        >
          <p style="margin: 0 0 8px 0; font-weight: 600; color: #4a4e69">
            Preview
          </p>
          <img
            id="preview-img"
            src=""
            alt="preview"
            style="
              max-width: 100%;
              border-radius: 12px;
              box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            "
          />
        </div>

        <!-- ‚¨áÔ∏è added: scan button + results under preview -->
        <div style="margin-top: 12px">
          <button
            type="button"
            id="scan"
            style="
              display: none;
              width: 100%;
              background: linear-gradient(90deg, #f672a7, #fcb7d4);
              color: #fff;
              font-weight: 700;
              font-size: 1.25rem;
              padding: 16px 0;
              border: none;
              border-radius: 999px;
              box-shadow: 0 4px 16px rgba(246, 114, 167, 0.18);
              margin-bottom: 12px;
              cursor: pointer;
              letter-spacing: 0.5px;
              font-family: Montserrat, system-ui, -apple-system, Segoe UI,
                Roboto, 'Helvetica Neue', Arial;
              transition: box-shadow 0.2s;
            "
            onmouseover="this.style.boxShadow='0 8px 32px rgba(246, 114, 167, 0.35)'"
            onmouseout="this.style.boxShadow='0 4px 16px rgba(246, 114, 167, 0.18)'"
          >
            Scan Ingredients
          </button>
        </div>
        <pre
          id="result"
          style="white-space: pre-wrap; margin-top: 8px; display: none"
        ></pre>
        <div class="flex flex-col items-center mb-12">
          <div
            id="risk-report"
            class="w-full max-w-2xl bg-white rounded-xl shadow p-8"
            style="display: none; margin-top: 24px"
          >
            <h2 class="text-2xl font-bold mb-4 text-[#D72660]">
              Risk & Environment Report
            </h2>
            <div id="risk-content" class="space-y-6"></div>
          </div>
        </div>

        <!-- hidden file input -->
        <input
          id="file-input"
          type="file"
          accept="image/*"
          style="display: none"
        />
      </form>
    </main>

    <!-- your existing JS file (upload + camera logic) -->
    <script src="/public/scan-ingredient.js"></script>
    <script>
      function getRiskIndicator(score) {
        if (score <= 33)
          return {
            color: "#1B998B",
            label: "üü¢ Low",
            bg: "bg-green-100",
            text: "text-green-700",
          };
        if (score <= 66)
          return {
            color: "#F4ACB7",
            label: "üü† Moderate",
            bg: "bg-orange-100",
            text: "text-orange-700",
          };
        return {
          color: "#D72660",
          label: "üî¥ High",
          bg: "bg-red-100",
          text: "text-red-700",
        };
      }
      // Render risk & environment report from localStorage JSON
      function renderRiskReport(data) {
        const container = document.getElementById("risk-content");
        if (!data || !data.analysis) {
          container.innerHTML =
            '<div class="text-gray-500 text-left font-medium">No report data found.</div>';
          return;
        }
        let html = "";
        // --- Color scheme indicator ---
        const healthScore = data.summary?.health_score ?? 0;
        const envScore = data.summary?.environment_score ?? 0;
        const healthIndicator = getRiskIndicator(healthScore);
        const envIndicator = getRiskIndicator(envScore);
        html += `<div class="flex flex-col sm:flex-row justify-center items-center gap-6 mb-8">
          <div class="flex flex-col items-center">
            <span class="text-lg font-bold mb-1" style="color:${healthIndicator.color}; font-family: Montserrat, sans-serif;">Health Risk</span>
            <span class="inline-block px-4 py-2 rounded-full ${healthIndicator.bg} ${healthIndicator.text} font-black text-base" style="font-family: Montserrat, sans-serif; font-size:1.1rem;">${healthIndicator.label} <span style="font-size:0.95em;">(${healthScore}/100)</span></span>
          </div>
          <div class="flex flex-col items-center">
            <span class="text-lg font-bold mb-1" style="color:${envIndicator.color}; font-family: Montserrat, sans-serif;">Environmental Risk</span>
            <span class="inline-block px-4 py-2 rounded-full ${envIndicator.bg} ${envIndicator.text} font-black text-base" style="font-family: Montserrat, sans-serif; font-size:1.1rem;">${envIndicator.label} <span style="font-size:0.95em;">(${envScore}/100)</span></span>
          </div>
        </div>`;
        // Health hazards
        const healthHazards = data.analysis.filter(
          (it) => it.hazard_level && it.hazard_level !== "Unknown"
        );
        if (healthHazards.length) {
          html +=
            '<h3 class="text-3xl font-extrabold text-[#D72660] mb-6 text-center" style="font-family: Montserrat, sans-serif; letter-spacing: 0.5px;">ü©∫ Health Hazards</h3>';
          healthHazards.forEach((it) => {
            // Health hazard items
            html += `<div class="mb-6 p-5 rounded-xl border bg-gray-50" style="font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; text-align:left;">
  <div class="font-black mb-2 flex items-center" style="text-align:left; font-size:1.35rem; font-family: 'Playfair Display', serif; text-shadow: 0 2px 6px rgba(215,38,96,0.10); letter-spacing: 0.5px;"><span style="margin-right:10px;">üî¨</span>${
    it.name
  }</div>
  <div class="font-black text-sm mb-1 flex items-center" style="text-align:left; font-size:1.1rem; font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; text-shadow: 0 2px 6px rgba(215,38,96,0.08);"><span style="margin-right:8px;">üß≠</span><span class="font-black">Hazard Level:</span> <span class="inline-block px-2 py-0.5 rounded-full text-xs font-black ml-2 ${
    it.hazard_level === "High"
      ? "bg-red-100 text-red-700"
      : it.hazard_level === "Medium"
      ? "bg-orange-100 text-orange-700"
      : "bg-green-100 text-green-700"
  }>${
              it.hazard_level === "High"
                ? "‚ö†Ô∏è High"
                : it.hazard_level === "Medium"
                ? "üü† Medium"
                : "üü¢ Low"
            }</span></div>
  ${
    it.reasons?.length
      ? `<div class=\"mt-2 text-sm text-gray-700 font-black flex items-center\" style=\"text-align:left; font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;\"><span style=\"margin-right:8px;\">‚ùì</span><span class=\"font-black\">Why hazardous?</span></div><div class=\"text-sm text-gray-700 font-normal ml-7 mb-2" style="text-align:left; font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;\">${it.reasons.join(
          "; "
        )}</div>`
      : ""
  }
  <div class="mt-2 text-sm text-gray-700 font-black flex items-center" style="text-align:left; font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;"><span style="margin-right:8px;">üåç</span><span class="font-black">Sources:</span></div>
  <ul class="list-disc pl-7 text-xs text-gray-600 mt-1 font-normal" style="text-align:left; font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;">${[
    it.source_regulatory,
    it.source_scientific,
    it.source_consumer,
  ]
    .filter(Boolean)
    .map((s) => `<li>${s}</li>`)
    .join("")}</ul>
</div>`;
          });
        }
        // Environment hazards
        const envHazards = data.analysis.filter((it) => {
          const ei = it.environmental_impact || {};
          return [ei.aquatic_toxicity, ei.bioaccumulation, ei.persistence].some(
            (l) => /high|moderate/i.test(l)
          );
        });
        if (envHazards.length) {
          html +=
            '<h3 class="text-3xl font-extrabold text-[#1B998B] mb-6 text-center" style="font-family: Montserrat, sans-serif; letter-spacing: 0.5px;">üå± Environmental Hazards</h3>';
          envHazards.forEach((it) => {
            const ei = it.environmental_impact || {};
            // Environmental hazard items
            html += `<div class="mb-6 p-5 rounded-xl border bg-gray-50" style="font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; text-align:left;">
      <div class="font-black mb-2 flex items-center" style="text-align:left; font-size:1.35rem; font-family: 'Playfair Display', serif; text-shadow: 0 2px 6px rgba(27,153,139,0.10); letter-spacing: 0.5px;"><span style="margin-right:10px;">üî¨</span>${
        it.name
      }</div>
      <div class="grid sm:grid-cols-3 gap-2 text-sm mb-2" style="text-align:left;">
        ${
          ei.aquatic_toxicity && /high|moderate/i.test(ei.aquatic_toxicity)
            ? `<div class=\"font-black flex items-center\" style=\"text-align:left; font-size:1.1rem; font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; text-shadow: 0 2px 6px rgba(27,153,139,0.08);\"><span style=\"margin-right:8px;\">üíß</span>Aquatic toxicity: <span class=\"font-normal ml-1\">${ei.aquatic_toxicity}</span></div>`
            : ""
        }
        ${
          ei.bioaccumulation && /high|moderate/i.test(ei.bioaccumulation)
            ? `<div class=\"font-black flex items-center\" style=\"text-align:left; font-size:1.1rem; font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; text-shadow: 0 2px 6px rgba(27,153,139,0.08);\"><span style=\"margin-right:8px;\">ü¶†</span>Bioaccumulation: <span class=\"font-normal ml-1\">${ei.bioaccumulation}</span></div>`
            : ""
        }
        ${
          ei.persistence && /high|moderate/i.test(ei.persistence)
            ? `<div class=\"font-black flex items-center\" style=\"text-align:left; font-size:1.1rem; font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; text-shadow: 0 2px 6px rgba(27,153,139,0.08);\"><span style=\"margin-right:8px;\">‚è≥</span>Persistence: <span class=\"font-normal ml-1\">${ei.persistence}</span></div>`
            : ""
        }
      </div>
      ${
        it.reasons?.length
          ? `<div class="mt-2 text-sm text-gray-700 font-black flex items-center" style="text-align:left;"><span style="margin-right:8px;">‚ùì</span>Why hazardous? <span class="font-normal ml-2">${it.reasons.join(
              "; "
            )}</span></div>`
          : ""
      }
      <div class="mt-2 text-sm text-gray-700 font-black flex items-center" style="text-align:left;"><span style="margin-right:8px;">üåç</span>Sources:</div>
      <ul class="list-disc pl-7 text-xs text-gray-600 mt-1 font-normal" style="text-align:left;">${[
        it.source_regulatory,
        it.source_scientific,
        it.source_consumer,
      ]
        .filter(Boolean)
        .map((s) => `<li>${s}</li>`)
        .join("")}</ul>
    </div>`;
          });
        }
        container.innerHTML = html;
      }
      // Scan button logic
      document.addEventListener("DOMContentLoaded", () => {
        const scanBtn = document.getElementById("scan");
        const fileInput = document.getElementById("file-input");
        const resultEl = document.getElementById("result");
        const riskReport = document.getElementById("risk-report");
        const uploadBtn = document.getElementById("upload-picture");
        const takeBtn = document.getElementById("take-picture");
        if (!scanBtn) return;
        scanBtn.addEventListener("click", async () => {
          const file = fileInput.files && fileInput.files[0];
          if (!file) {
            alert("Please upload or capture an image first.");
            return;
          }
          const form = new FormData();
          form.append("image", file);
          try {
            const res = await fetch("http://127.0.0.1:8080/check-ingredients", {
              method: "POST",
              body: form,
            });
            const data = await res.json();
            localStorage.setItem("formulyst_report", JSON.stringify(data));
            resultEl.style.display = "none";
            riskReport.style.display = "block";
            renderRiskReport(data);
          } catch (e) {
            resultEl.textContent = "Error: " + e.message;
            resultEl.style.display = "block";
            riskReport.style.display = "none";
          }
        });
        if (uploadBtn) {
          uploadBtn.addEventListener("click", () => {
            fileInput.click();
          });
        }
        if (fileInput) {
          fileInput.addEventListener("change", () => {
            if (fileInput.files && fileInput.files[0]) {
              scanBtn.style.display = "block";
              document.getElementById("brand-name").style.display = "none";
              uploadBtn.style.display = "none";
              takeBtn.style.display = "none";
              document.querySelector(".search-btn").style.display = "none";
            }
          });
        }
        if (takeBtn) {
          takeBtn.addEventListener("click", () => {
            setTimeout(() => {
              scanBtn.style.display = "block";
              document.getElementById("brand-name").style.display = "none";
              uploadBtn.style.display = "none";
              takeBtn.style.display = "none";
              document.querySelector(".search-btn").style.display = "none";
            }, 500);
          });
        }
      });
    </script>
  </body>
</html>
